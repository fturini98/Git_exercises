name: Lesson6
run-name: ${{ github.actor }} is checking the name in read me and building te pdf
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main     

jobs:
    Egocentirc:
      runs-on: ubuntu-latest
      steps:
        - name: Cloning Repository
          uses: actions/checkout@v4
        - name: Showing the files
          run: |
           ls ${{ github.workspace }}
        - name: Verify README.md
          id: check-name
          run: |
             if ! grep -q "Francesco Turini" README.md; then
               echo "README.md does not contain the required name. Adding it ..."
               exit 1
              else
              echo " 'Francesco Turini' is already in README.md."
             fi
    
    DitchOverleaf:
      runs-on: ubuntu-latest
      env:
        DIR: Links
        FILE: main

      steps:

        - name: Cloning Repository
          uses: actions/checkout@v2
        
        - name: Create symbolic link for main.tex
          run: |
            cd ${{ env.DIR }}
            if [ ! -f .symlink ]; then
              echo "Errore: Il file .symlink non esiste."
              exit 1
            fi
            TARGET=$(cat .symlink)  # Legge il percorso del file target
            if [ ! -f "$TARGET" ]; then
              echo "Errore: Il file target '$TARGET' non esiste."
              exit 1
            fi
            ln -sf "$TARGET" main.tex  # Crea il symbolic link chiamato main.tex
            echo "Symbolic link creato: main.tex -> $TARGET"

        - name: Load latex compiler and compile
          uses: xu-cheng/texlive-action@v2
          with:
            run: |
              cd ${{ env.DIR }}
              pdflatex ${{ env.FILE }}
              bibtex ${{ env.FILE }}
              pdflatex ${{ env.FILE }}
              pdflatex ${{ env.FILE }}
        
        - name: Save pdf as artifact
          run: |
            echo 'Creating pdf'
            mkdir -p artifacts
            mv ${{ env.DIR }}/${{ env.FILE }}.pdf ./artifacts/

        - name: Upload pdf as artifact
          uses: actions/upload-artifact@v4
          with:
            name: ${{ env.FILE }}.pdf
            path: ./artifacts